{% extends "base.html" %}

{% block title %}Blockchain Payments - World Tour{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <!-- Hero Section -->
    <div class="hero-section bg-gradient-primary text-white py-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold mb-4">Blockchain Payments</h1>
                    <p class="lead mb-4">Pay for your travels with cryptocurrency. Secure, transparent, and instant transactions powered by blockchain technology.</p>
                    <div class="d-flex gap-3">
                        <button class="btn btn-light btn-lg" data-bs-toggle="modal" data-bs-target="#paymentModal">
                            <i class="fas fa-coins me-2"></i>Make Payment
                        </button>
                        <button class="btn btn-outline-light btn-lg" data-bs-toggle="modal" data-bs-target="#walletModal">
                            <i class="fas fa-wallet me-2"></i>Connect Wallet
                        </button>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="blockchain-animation text-center">
                        <div class="blockchain-chain">
                            <div class="block"></div>
                            <div class="block"></div>
                            <div class="block"></div>
                            <div class="block"></div>
                        </div>
                        <p class="text-white-50 mt-3">Secure blockchain transactions</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supported Cryptocurrencies -->
    <div class="container py-5">
        <h2 class="text-center mb-5">Supported Cryptocurrencies</h2>
        <div class="row g-4">
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body p-4 text-center">
                        <div class="crypto-icon bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                            <i class="fab fa-bitcoin fa-2x"></i>
                        </div>
                        <h5 class="card-title">Bitcoin (BTC)</h5>
                        <p class="card-text">The original cryptocurrency. Fast and secure global payments.</p>
                        <div class="crypto-price">
                            <span class="h6 text-primary" id="btcPrice">$43,250.00</span>
                            <span class="badge bg-success ms-2" id="btcChange">+2.5%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body p-4 text-center">
                        <div class="crypto-icon bg-info text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                            <i class="fab fa-ethereum fa-2x"></i>
                        </div>
                        <h5 class="card-title">Ethereum (ETH)</h5>
                        <p class="card-text">Smart contract platform with fast transaction speeds.</p>
                        <div class="crypto-price">
                            <span class="h6 text-primary" id="ethPrice">$2,650.00</span>
                            <span class="badge bg-success ms-2" id="ethChange">+1.8%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body p-4 text-center">
                        <div class="crypto-icon bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                            <i class="fas fa-coins fa-2x"></i>
                        </div>
                        <h5 class="card-title">USDC</h5>
                        <p class="card-text">Stablecoin pegged to USD. Perfect for price stability.</p>
                        <div class="crypto-price">
                            <span class="h6 text-primary" id="usdcPrice">$1.00</span>
                            <span class="badge bg-secondary ms-2" id="usdcChange">0.0%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body p-4 text-center">
                        <div class="crypto-icon bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                            <i class="fas fa-rocket fa-2x"></i>
                        </div>
                        <h5 class="card-title">Solana (SOL)</h5>
                        <p class="card-text">High-performance blockchain with low transaction fees.</p>
                        <div class="crypto-price">
                            <span class="h6 text-primary" id="solPrice">$98.50</span>
                            <span class="badge bg-danger ms-2" id="solChange">-0.5%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Interface -->
    <div class="bg-light py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0"><i class="fas fa-coins me-2"></i>Cryptocurrency Payment</h4>
                        </div>
                        <div class="card-body">
                            <form id="cryptoPaymentForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Payment Amount (USD)</label>
                                        <input type="number" class="form-control" id="usdAmount" value="100" min="1" step="0.01">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Cryptocurrency</label>
                                        <select class="form-select" id="cryptoSelect">
                                            <option value="BTC">Bitcoin (BTC)</option>
                                            <option value="ETH">Ethereum (ETH)</option>
                                            <option value="USDC">USDC</option>
                                            <option value="SOL">Solana (SOL)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Crypto Amount</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="cryptoAmount" readonly>
                                        <span class="input-group-text" id="cryptoUnit">BTC</span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Wallet Address</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="walletAddress" placeholder="Enter your wallet address">
                                        <button class="btn btn-outline-secondary" type="button" id="connectWalletBtn">
                                            <i class="fas fa-wallet me-2"></i>Connect
                                        </button>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Transaction Details</label>
                                    <div class="transaction-details">
                                        <div class="row">
                                            <div class="col-6">Amount:</div>
                                            <div class="col-6" id="detailAmount">$100.00</div>
                                        </div>
                                        <div class="row">
                                            <div class="col-6">Network Fee:</div>
                                            <div class="col-6" id="detailFee">$2.50</div>
                                        </div>
                                        <div class="row">
                                            <div class="col-6">Processing Fee:</div>
                                            <div class="col-6" id="detailProcessing">$1.00</div>
                                        </div>
                                        <hr>
                                        <div class="row fw-bold">
                                            <div class="col-6">Total:</div>
                                            <div class="col-6" id="detailTotal">$103.50</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-center">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-lock me-2"></i>Pay Securely
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Smart Contract Features -->
    <div class="container py-5">
        <h2 class="text-center mb-5">Smart Contract Features</h2>
        <div class="row g-4">
            <div class="col-lg-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="feature-icon bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <i class="fas fa-shield-alt fa-2x"></i>
                        </div>
                        <h5 class="card-title">Escrow Protection</h5>
                        <p class="card-text">Your payment is held in escrow until your trip is completed. Automatic refunds if services aren't delivered.</p>
                        <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#escrowModal">Learn More</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="feature-icon bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <i class="fas fa-robot fa-2x"></i>
                        </div>
                        <h5 class="card-title">Automated Refunds</h5>
                        <p class="card-text">Smart contracts automatically process refunds for cancellations and service issues without manual intervention.</p>
                        <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#refundModal">Learn More</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="feature-icon bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <i class="fas fa-eye fa-2x"></i>
                        </div>
                        <h5 class="card-title">Transparent Transactions</h5>
                        <p class="card-text">All transactions are recorded on the blockchain and can be verified by anyone. Complete transparency.</p>
                        <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#transparencyModal">Learn More</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction History -->
    <div class="bg-light py-5">
        <div class="container">
            <h2 class="text-center mb-5">Recent Transactions</h2>
            <div class="row">
                <div class="col-lg-10 mx-auto">
                    <div class="card shadow">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-history me-2"></i>Blockchain Transaction History</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Transaction Hash</th>
                                            <th>Type</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="transactionHistory">
                                        <tr>
                                            <td><code>0x7a8b9c...</code></td>
                                            <td><span class="badge bg-success">Payment</span></td>
                                            <td>0.0023 BTC</td>
                                            <td><span class="badge bg-success">Confirmed</span></td>
                                            <td>2025-01-15 14:30</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary" onclick="viewTransaction('0x7a8b9c...')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><code>0x1d2e3f...</code></td>
                                            <td><span class="badge bg-warning">Refund</span></td>
                                            <td>0.0018 ETH</td>
                                            <td><span class="badge bg-success">Confirmed</span></td>
                                            <td>2025-01-14 09:15</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary" onclick="viewTransaction('0x1d2e3f...')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Payment Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Complete Payment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <div class="qr-code-container">
                        <div class="qr-code" id="paymentQR"></div>
                        <p class="text-muted mt-2">Scan QR code with your wallet</p>
                    </div>
                </div>
                <div class="payment-details">
                    <h6>Payment Details</h6>
                    <div class="row">
                        <div class="col-6">Amount:</div>
                        <div class="col-6" id="modalAmount">$100.00</div>
                    </div>
                    <div class="row">
                        <div class="col-6">Crypto Amount:</div>
                        <div class="col-6" id="modalCryptoAmount">0.0023 BTC</div>
                    </div>
                    <div class="row">
                        <div class="col-6">Network:</div>
                        <div class="col-6" id="modalNetwork">Bitcoin</div>
                    </div>
                </div>
                <div class="alert alert-info mt-3">
                    <i class="fas fa-info-circle me-2"></i>
                    Payment will be confirmed once the transaction is processed on the blockchain.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="confirmPayment()">Confirm Payment</button>
            </div>
        </div>
    </div>
</div>

<!-- Wallet Connection Modal -->
<div class="modal fade" id="walletModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Connect Wallet</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="wallet-options">
                    <button class="btn btn-outline-primary w-100 mb-3" onclick="connectWallet('metamask')">
                        <i class="fab fa-ethereum me-2"></i>MetaMask
                    </button>
                    <button class="btn btn-outline-success w-100 mb-3" onclick="connectWallet('walletconnect')">
                        <i class="fas fa-wallet me-2"></i>WalletConnect
                    </button>
                    <button class="btn btn-outline-warning w-100 mb-3" onclick="connectWallet('coinbase')">
                        <i class="fas fa-coins me-2"></i>Coinbase Wallet
                    </button>
                    <button class="btn btn-outline-info w-100" onclick="connectWallet('phantom')">
                        <i class="fas fa-ghost me-2"></i>Phantom (Solana)
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.blockchain-chain {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
}

.block {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 8px;
    animation: blockPulse 2s ease-in-out infinite;
}

.block:nth-child(2) { animation-delay: 0.5s; }
.block:nth-child(3) { animation-delay: 1s; }
.block:nth-child(4) { animation-delay: 1.5s; }

@keyframes blockPulse {
    0%, 100% { transform: scale(1); opacity: 0.5; }
    50% { transform: scale(1.1); opacity: 1; }
}

.crypto-icon {
    transition: transform 0.3s ease;
}

.crypto-icon:hover {
    transform: scale(1.1);
}

.transaction-details {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
}

.qr-code {
    width: 200px;
    height: 200px;
    background: #f8f9fa;
    border: 2px solid #dee2e6;
    border-radius: 8px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: #6c757d;
}

.wallet-options button {
    transition: all 0.3s ease;
}

.wallet-options button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.feature-icon {
    transition: transform 0.3s ease;
}

.feature-icon:hover {
    transform: scale(1.1);
}
</style>

<script>
class BlockchainPayments {
    constructor() {
        this.cryptoPrices = {
            BTC: 43250,
            ETH: 2650,
            USDC: 1,
            SOL: 98.5
        };
        this.bindEvents();
        this.updatePrices();
    }

    bindEvents() {
        document.getElementById('usdAmount').addEventListener('input', () => {
            this.updateCryptoAmount();
        });

        document.getElementById('cryptoSelect').addEventListener('change', () => {
            this.updateCryptoAmount();
            this.updateCryptoUnit();
        });

        document.getElementById('cryptoPaymentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.processPayment();
        });

        document.getElementById('connectWalletBtn').addEventListener('click', () => {
            bootstrap.Modal.getInstance(document.getElementById('walletModal')).show();
        });
    }

    updatePrices() {
        // Simulate real-time price updates
        setInterval(() => {
            Object.keys(this.cryptoPrices).forEach(crypto => {
                if (crypto !== 'USDC') {
                    const change = (Math.random() - 0.5) * 0.1; // ±5% change
                    this.cryptoPrices[crypto] *= (1 + change);
                    this.updatePriceDisplay(crypto);
                }
            });
        }, 10000); // Update every 10 seconds
    }

    updatePriceDisplay(crypto) {
        const priceElement = document.getElementById(crypto.toLowerCase() + 'Price');
        const changeElement = document.getElementById(crypto.toLowerCase() + 'Change');
        
        if (priceElement && changeElement) {
            priceElement.textContent = '$' + this.cryptoPrices[crypto].toFixed(2);
            
            const change = (Math.random() - 0.5) * 0.1;
            const changePercent = (change * 100).toFixed(1);
            const changeClass = change >= 0 ? 'bg-success' : 'bg-danger';
            const changeSign = change >= 0 ? '+' : '';
            
            changeElement.textContent = changeSign + changePercent + '%';
            changeElement.className = 'badge ' + changeClass + ' ms-2';
        }
    }

    updateCryptoAmount() {
        const usdAmount = parseFloat(document.getElementById('usdAmount').value);
        const selectedCrypto = document.getElementById('cryptoSelect').value;
        const cryptoPrice = this.cryptoPrices[selectedCrypto];
        
        if (cryptoPrice && usdAmount) {
            const cryptoAmount = usdAmount / cryptoPrice;
            document.getElementById('cryptoAmount').value = cryptoAmount.toFixed(6);
            this.updateTransactionDetails();
        }
    }

    updateCryptoUnit() {
        const selectedCrypto = document.getElementById('cryptoSelect').value;
        document.getElementById('cryptoUnit').textContent = selectedCrypto;
    }

    updateTransactionDetails() {
        const usdAmount = parseFloat(document.getElementById('usdAmount').value);
        const networkFee = 2.50;
        const processingFee = 1.00;
        const total = usdAmount + networkFee + processingFee;

        document.getElementById('detailAmount').textContent = '$' + usdAmount.toFixed(2);
        document.getElementById('detailFee').textContent = '$' + networkFee.toFixed(2);
        document.getElementById('detailProcessing').textContent = '$' + processingFee.toFixed(2);
        document.getElementById('detailTotal').textContent = '$' + total.toFixed(2);
    }

    processPayment() {
        const usdAmount = document.getElementById('usdAmount').value;
        const selectedCrypto = document.getElementById('cryptoSelect').value;
        const cryptoAmount = document.getElementById('cryptoAmount').value;
        const walletAddress = document.getElementById('walletAddress').value;

        if (!walletAddress) {
            alert('Please enter a wallet address or connect your wallet.');
            return;
        }

        // Show payment modal
        document.getElementById('modalAmount').textContent = '$' + usdAmount;
        document.getElementById('modalCryptoAmount').textContent = cryptoAmount + ' ' + selectedCrypto;
        document.getElementById('modalNetwork').textContent = this.getNetworkName(selectedCrypto);

        bootstrap.Modal.getInstance(document.getElementById('paymentModal')).show();
    }

    getNetworkName(crypto) {
        const networks = {
            'BTC': 'Bitcoin',
            'ETH': 'Ethereum',
            'USDC': 'Ethereum',
            'SOL': 'Solana'
        };
        return networks[crypto] || crypto;
    }
}

// Global functions
function connectWallet(walletType) {
    const walletNames = {
        'metamask': 'MetaMask',
        'walletconnect': 'WalletConnect',
        'coinbase': 'Coinbase Wallet',
        'phantom': 'Phantom'
    };

    // Simulate wallet connection
    setTimeout(() => {
        const address = '0x' + Math.random().toString(16).substr(2, 40);
        document.getElementById('walletAddress').value = address;
        bootstrap.Modal.getInstance(document.getElementById('walletModal')).hide();
        
        alert(`${walletNames[walletType]} connected successfully!\nAddress: ${address}`);
    }, 1000);
}

function confirmPayment() {
    const modal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
    
    // Simulate payment processing
    const button = document.querySelector('#paymentModal .btn-primary');
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
    
    setTimeout(() => {
        // Generate transaction hash
        const txHash = '0x' + Math.random().toString(16).substr(2, 64);
        
        // Add to transaction history
        const tbody = document.getElementById('transactionHistory');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td><code>${txHash.substr(0, 8)}...</code></td>
            <td><span class="badge bg-success">Payment</span></td>
            <td>${document.getElementById('modalCryptoAmount').textContent}</td>
            <td><span class="badge bg-success">Confirmed</span></td>
            <td>${new Date().toLocaleString()}</td>
            <td>
                <button class="btn btn-sm btn-outline-primary" onclick="viewTransaction('${txHash}')">
                    <i class="fas fa-eye"></i>
                </button>
            </td>
        `;
        tbody.insertBefore(newRow, tbody.firstChild);
        
        modal.hide();
        alert('Payment successful! Transaction hash: ' + txHash);
        
        // Reset form
        document.getElementById('cryptoPaymentForm').reset();
        document.getElementById('cryptoAmount').value = '';
    }, 3000);
}

function viewTransaction(hash) {
    alert('Transaction Details:\nHash: ' + hash + '\nStatus: Confirmed\nBlock: 12345678\nGas Used: 21000');
}

// Initialize blockchain payments when page loads
document.addEventListener('DOMContentLoaded', function() {
    new BlockchainPayments();
});
</script>
{% endblock %} 