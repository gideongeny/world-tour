{% extends "base.html" %}

{% block title %}Loyalty Program - World Tour{% endblock %}
{% block description %}Earn points on every booking and redeem them for exclusive rewards, discounts, and upgrades on your next adventure.{% endblock %}

{% block content %}
<div class="loyalty-page">
    <!-- Hero Section -->
    <div class="loyalty-hero">
        <div class="container">
            <div class="loyalty-hero-content">
                <h1>World Tour Rewards</h1>
                <p>Earn points on every booking and unlock exclusive benefits</p>
                
                {% if current_user.is_authenticated %}
                <div class="user-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-info">
                            <h3>{{ current_user.points|default(0) }}</h3>
                            <p>Total Points</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="stat-info">
                            <h3>{{ current_user.tier|default('Bronze') }}</h3>
                            <p>Current Tier</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="stat-info">
                            <h3>{{ current_user.rewards_available|default(0) }}</h3>
                            <p>Available Rewards</p>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="cta-section">
                    <a href="{{ url_for('register') }}" class="btn btn-primary btn-large">Join Rewards Program</a>
                    <a href="{{ url_for('login') }}" class="btn btn-outline btn-large">Sign In</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- How It Works -->
    <div class="how-it-works">
        <div class="container">
            <div class="section-header">
                <h2>How It Works</h2>
                <p>Start earning points from your very first booking</p>
            </div>
            
            <div class="steps-grid">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <div class="step-icon">
                        <i class="fas fa-plane"></i>
                    </div>
                    <h3>Book & Travel</h3>
                    <p>Book any destination through World Tour and start earning points immediately</p>
                </div>
                
                <div class="step-card">
                    <div class="step-number">2</div>
                    <div class="step-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <h3>Earn Points</h3>
                    <p>Earn 10 points for every $1 spent on bookings, plus bonus points for reviews</p>
                </div>
                
                <div class="step-card">
                    <div class="step-number">3</div>
                    <div class="step-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <h3>Redeem Rewards</h3>
                    <p>Use your points for discounts, upgrades, and exclusive experiences</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tiers Section -->
    <div class="tiers-section">
        <div class="container">
            <div class="section-header">
                <h2>Membership Tiers</h2>
                <p>Unlock more benefits as you earn more points</p>
            </div>
            
            <div class="tiers-grid">
                <div class="tier-card bronze">
                    <div class="tier-header">
                        <div class="tier-icon">
                            <i class="fas fa-medal"></i>
                        </div>
                        <h3>Bronze</h3>
                        <p>0 - 1,000 points</p>
                    </div>
                    <div class="tier-benefits">
                        <ul>
                            <li><i class="fas fa-check"></i> 10 points per $1 spent</li>
                            <li><i class="fas fa-check"></i> Basic customer support</li>
                            <li><i class="fas fa-check"></i> Email updates</li>
                        </ul>
                    </div>
                </div>
                
                <div class="tier-card silver">
                    <div class="tier-header">
                        <div class="tier-icon">
                            <i class="fas fa-medal"></i>
                        </div>
                        <h3>Silver</h3>
                        <p>1,001 - 5,000 points</p>
                    </div>
                    <div class="tier-benefits">
                        <ul>
                            <li><i class="fas fa-check"></i> 12 points per $1 spent</li>
                            <li><i class="fas fa-check"></i> Priority customer support</li>
                            <li><i class="fas fa-check"></i> 5% discount on bookings</li>
                            <li><i class="fas fa-check"></i> Free cancellation up to 48h</li>
                        </ul>
                    </div>
                </div>
                
                <div class="tier-card gold">
                    <div class="tier-header">
                        <div class="tier-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                        <h3>Gold</h3>
                        <p>5,001 - 15,000 points</p>
                    </div>
                    <div class="tier-benefits">
                        <ul>
                            <li><i class="fas fa-check"></i> 15 points per $1 spent</li>
                            <li><i class="fas fa-check"></i> VIP customer support</li>
                            <li><i class="fas fa-check"></i> 10% discount on bookings</li>
                            <li><i class="fas fa-check"></i> Free room upgrades</li>
                            <li><i class="fas fa-check"></i> Early booking access</li>
                        </ul>
                    </div>
                </div>
                
                <div class="tier-card platinum">
                    <div class="tier-header">
                        <div class="tier-icon">
                            <i class="fas fa-gem"></i>
                        </div>
                        <h3>Platinum</h3>
                        <p>15,001+ points</p>
                    </div>
                    <div class="tier-benefits">
                        <ul>
                            <li><i class="fas fa-check"></i> 20 points per $1 spent</li>
                            <li><i class="fas fa-check"></i> Dedicated travel concierge</li>
                            <li><i class="fas fa-check"></i> 15% discount on bookings</li>
                            <li><i class="fas fa-check"></i> Complimentary airport transfers</li>
                            <li><i class="fas fa-check"></i> Exclusive destination access</li>
                            <li><i class="fas fa-check"></i> Birthday rewards</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rewards Section -->
    {% if current_user.is_authenticated %}
    <div class="rewards-section">
        <div class="container">
            <div class="section-header">
                <h2>Available Rewards</h2>
                <p>Redeem your points for amazing rewards</p>
            </div>
            
            <div class="rewards-grid">
                <div class="reward-card">
                    <div class="reward-image">
                        <img src="{{ url_for('static', filename='discount.jpg') }}" alt="Discount">
                    </div>
                    <div class="reward-content">
                        <h3>$50 Travel Credit</h3>
                        <p>Use this credit towards any booking</p>
                        <div class="reward-cost">
                            <span class="points">500 points</span>
                            <button class="btn btn-primary" onclick="redeemReward('travel_credit')">Redeem</button>
                        </div>
                    </div>
                </div>
                
                <div class="reward-card">
                    <div class="reward-image">
                        <img src="{{ url_for('static', filename='upgrade.jpg') }}" alt="Upgrade">
                    </div>
                    <div class="reward-content">
                        <h3>Room Upgrade</h3>
                        <p>Free room upgrade on your next stay</p>
                        <div class="reward-cost">
                            <span class="points">1,000 points</span>
                            <button class="btn btn-primary" onclick="redeemReward('room_upgrade')">Redeem</button>
                        </div>
                    </div>
                </div>
                
                <div class="reward-card">
                    <div class="reward-image">
                        <img src="{{ url_for('static', filename='transfer.jpg') }}" alt="Transfer">
                    </div>
                    <div class="reward-content">
                        <h3>Airport Transfer</h3>
                        <p>Complimentary airport transfer</p>
                        <div class="reward-cost">
                            <span class="points">750 points</span>
                            <button class="btn btn-primary" onclick="redeemReward('airport_transfer')">Redeem</button>
                        </div>
                    </div>
                </div>
                
                <div class="reward-card">
                    <div class="reward-image">
                        <img src="{{ url_for('static', filename='experience.jpg') }}" alt="Experience">
                    </div>
                    <div class="reward-content">
                        <h3>Local Experience</h3>
                        <p>Free local guided tour or activity</p>
                        <div class="reward-cost">
                            <span class="points">1,500 points</span>
                            <button class="btn btn-primary" onclick="redeemReward('local_experience')">Redeem</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Points History -->
    <div class="points-history">
        <div class="container">
            <div class="section-header">
                <h2>Points History</h2>
                <p>Track your points earning and redemption history</p>
            </div>
            
            <div class="history-table">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Points</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for transaction in points_history %}
                        <tr>
                            <td>{{ transaction.date.strftime('%B %d, %Y') }}</td>
                            <td>{{ transaction.description }}</td>
                            <td class="points-{{ transaction.type }}">
                                {% if transaction.type == 'earned' %}+{% else %}-{% endif %}{{ transaction.points }}
                            </td>
                            <td>
                                <span class="badge badge-{{ transaction.type }}">
                                    {{ transaction.type|title }}
                                </span>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="4" class="no-data">No points history yet. Start booking to earn points!</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- FAQ Section -->
    <div class="faq-section">
        <div class="container">
            <div class="section-header">
                <h2>Frequently Asked Questions</h2>
                <p>Everything you need to know about our rewards program</p>
            </div>
            
            <div class="faq-grid">
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <h3>How do I earn points?</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>You earn points on every booking made through World Tour. You get 10 points for every $1 spent, plus bonus points for leaving reviews and referring friends.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <h3>Do points expire?</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Points earned through bookings never expire as long as your account remains active. However, bonus points from promotions may have expiration dates.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <h3>How do I redeem rewards?</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Simply click the "Redeem" button on any available reward. The points will be deducted from your account and the reward will be applied to your next booking.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <h3>Can I transfer points to another account?</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Points are non-transferable and can only be used by the account holder who earned them. This helps maintain the integrity of our rewards program.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Loyalty Page Styles */
.loyalty-page {
    background: #f8f9fa;
    min-height: 100vh;
}

.loyalty-hero {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 4rem 0;
    text-align: center;
}

.loyalty-hero h1 {
    font-size: 3.5rem;
    margin-bottom: 1rem;
    font-weight: 700;
}

.loyalty-hero p {
    font-size: 1.3rem;
    margin-bottom: 3rem;
    opacity: 0.9;
}

.user-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 2rem;
    max-width: 800px;
    margin: 0 auto;
}

.stat-card {
    background: rgba(255,255,255,0.1);
    padding: 2rem;
    border-radius: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    gap: 1rem;
}

.stat-icon {
    font-size: 2.5rem;
    color: #ffd700;
}

.stat-info h3 {
    font-size: 2rem;
    margin: 0;
    font-weight: 700;
}

.stat-info p {
    margin: 0;
    opacity: 0.8;
}

.cta-section {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

/* How It Works */
.how-it-works {
    padding: 5rem 0;
    background: white;
}

.section-header {
    text-align: center;
    margin-bottom: 4rem;
}

.section-header h2 {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: #333;
    font-weight: 700;
}

.section-header p {
    font-size: 1.2rem;
    color: #666;
    max-width: 600px;
    margin: 0 auto;
}

.steps-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.step-card {
    text-align: center;
    padding: 2rem;
    border-radius: 20px;
    background: #f8f9fa;
    position: relative;
    transition: transform 0.3s ease;
}

.step-card:hover {
    transform: translateY(-10px);
}

.step-number {
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
}

.step-icon {
    font-size: 3rem;
    color: #667eea;
    margin-bottom: 1rem;
}

.step-card h3 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: #333;
    font-weight: 600;
}

.step-card p {
    color: #666;
    line-height: 1.6;
}

/* Tiers Section */
.tiers-section {
    padding: 5rem 0;
    background: #f8f9fa;
}

.tiers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
}

.tier-card {
    background: white;
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
    position: relative;
    overflow: hidden;
}

.tier-card:hover {
    transform: translateY(-10px);
}

.tier-card.bronze {
    border-top: 4px solid #cd7f32;
}

.tier-card.silver {
    border-top: 4px solid #c0c0c0;
}

.tier-card.gold {
    border-top: 4px solid #ffd700;
}

.tier-card.platinum {
    border-top: 4px solid #e5e4e2;
}

.tier-header {
    text-align: center;
    margin-bottom: 2rem;
}

.tier-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.tier-card.bronze .tier-icon {
    color: #cd7f32;
}

.tier-card.silver .tier-icon {
    color: #c0c0c0;
}

.tier-card.gold .tier-icon {
    color: #ffd700;
}

.tier-card.platinum .tier-icon {
    color: #e5e4e2;
}

.tier-header h3 {
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
    color: #333;
    font-weight: 700;
}

.tier-header p {
    color: #666;
    font-weight: 600;
}

.tier-benefits ul {
    list-style: none;
    padding: 0;
}

.tier-benefits li {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.8rem;
    color: #333;
}

.tier-benefits i {
    color: #4ade80;
    font-size: 0.9rem;
}

/* Rewards Section */
.rewards-section {
    padding: 5rem 0;
    background: white;
}

.rewards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.reward-card {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.reward-card:hover {
    transform: translateY(-10px);
}

.reward-image {
    height: 200px;
    overflow: hidden;
}

.reward-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.reward-content {
    padding: 2rem;
}

.reward-content h3 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: #333;
    font-weight: 600;
}

.reward-content p {
    color: #666;
    margin-bottom: 1.5rem;
    line-height: 1.6;
}

.reward-cost {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.points {
    font-weight: bold;
    color: #667eea;
    font-size: 1.1rem;
}

/* Points History */
.points-history {
    padding: 5rem 0;
    background: #f8f9fa;
}

.history-table {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.history-table table {
    width: 100%;
    border-collapse: collapse;
}

.history-table th {
    background: #f8f9fa;
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: #333;
    border-bottom: 1px solid #e9ecef;
}

.history-table td {
    padding: 1rem;
    border-bottom: 1px solid #e9ecef;
    color: #333;
}

.points-earned {
    color: #4ade80;
    font-weight: bold;
}

.points-redeemed {
    color: #ff6b6b;
    font-weight: bold;
}

.badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.badge-earned {
    background: #dcfce7;
    color: #166534;
}

.badge-redeemed {
    background: #fee2e2;
    color: #991b1b;
}

.no-data {
    text-align: center;
    color: #666;
    font-style: italic;
}

/* FAQ Section */
.faq-section {
    padding: 5rem 0;
    background: white;
}

.faq-grid {
    max-width: 800px;
    margin: 0 auto;
}

.faq-item {
    border: 1px solid #e9ecef;
    border-radius: 12px;
    margin-bottom: 1rem;
    overflow: hidden;
}

.faq-question {
    padding: 1.5rem;
    background: #f8f9fa;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background 0.3s ease;
}

.faq-question:hover {
    background: #e9ecef;
}

.faq-question h3 {
    margin: 0;
    font-size: 1.1rem;
    color: #333;
    font-weight: 600;
}

.faq-question i {
    color: #667eea;
    transition: transform 0.3s ease;
}

.faq-question.active i {
    transform: rotate(180deg);
}

.faq-answer {
    padding: 0 1.5rem;
    max-height: 0;
    overflow: hidden;
    transition: all 0.3s ease;
}

.faq-answer.active {
    padding: 1.5rem;
    max-height: 200px;
}

.faq-answer p {
    margin: 0;
    color: #666;
    line-height: 1.6;
}

/* Responsive Design */
@media (max-width: 768px) {
    .loyalty-hero h1 {
        font-size: 2.5rem;
    }
    
    .user-stats {
        grid-template-columns: 1fr;
    }
    
    .cta-section {
        flex-direction: column;
        align-items: center;
    }
    
    .section-header h2 {
        font-size: 2rem;
    }
    
    .tiers-grid {
        grid-template-columns: 1fr;
    }
    
    .rewards-grid {
        grid-template-columns: 1fr;
    }
    
    .history-table {
        overflow-x: auto;
    }
}
</style>

<script>
function toggleFAQ(element) {
    const answer = element.nextElementSibling;
    const isActive = element.classList.contains('active');
    
    // Close all other FAQs
    document.querySelectorAll('.faq-question').forEach(q => {
        q.classList.remove('active');
        q.nextElementSibling.classList.remove('active');
    });
    
    // Toggle current FAQ
    if (!isActive) {
        element.classList.add('active');
        answer.classList.add('active');
    }
}

function redeemReward(rewardType) {
    if (confirm('Are you sure you want to redeem this reward?')) {
        // In a real app, this would make an API call
        alert('Reward redeemed successfully! You will receive an email with details.');
        
        // Update points display
        const pointsElement = document.querySelector('.stat-info h3');
        if (pointsElement) {
            let currentPoints = parseInt(pointsElement.textContent);
            let cost = 0;
            
            switch(rewardType) {
                case 'travel_credit':
                    cost = 500;
                    break;
                case 'room_upgrade':
                    cost = 1000;
                    break;
                case 'airport_transfer':
                    cost = 750;
                    break;
                case 'local_experience':
                    cost = 1500;
                    break;
            }
            
            pointsElement.textContent = currentPoints - cost;
        }
    }
}
</script>
{% endblock %} 