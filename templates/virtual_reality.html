{% extends "base.html" %}

{% block title %}Virtual Reality Tours - World Tour{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <!-- Hero Section -->
    <div class="hero-section bg-gradient-primary text-white py-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold mb-4">Virtual Reality Tours</h1>
                    <p class="lead mb-4">Experience destinations in immersive 360째 virtual reality. Explore cities, landmarks, and hotels before you book. Feel like you're already there!</p>
                    <div class="d-flex gap-3">
                        <button class="btn btn-light btn-lg" id="startVRTour">
                            <i class="fas fa-vr-cardboard me-2"></i>Start VR Tour
                        </button>
                        <button class="btn btn-outline-light btn-lg" data-bs-toggle="modal" data-bs-target="#vrHelpModal">
                            <i class="fas fa-question-circle me-2"></i>How to Use
                        </button>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="vr-animation text-center">
                        <div class="vr-headset">
                            <div class="vr-lens left"></div>
                            <div class="vr-lens right"></div>
                            <div class="vr-screen"></div>
                        </div>
                        <p class="text-white-50 mt-3">Immersive 360째 experiences</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VR Tour Interface -->
    <div class="container py-5">
        <div class="row">
            <div class="col-lg-9">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0"><i class="fas fa-vr-cardboard me-2"></i>Virtual Reality Experience</h4>
                        <div class="vr-controls">
                            <button class="btn btn-light btn-sm" id="fullscreenBtn">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="btn btn-light btn-sm" id="vrModeBtn">
                                <i class="fas fa-vr-cardboard"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <!-- VR Viewer -->
                        <div class="vr-viewer" id="vrViewer">
                            <div class="vr-scene" id="vrScene">
                                <!-- 360째 panorama will be loaded here -->
                                <div class="loading-spinner">
                                    <div class="spinner"></div>
                                    <p>Loading VR experience...</p>
                                </div>
                            </div>
                            
                            <!-- VR Hotspots -->
                            <div class="vr-hotspots" id="vrHotspots">
                                <!-- Hotspots will be generated dynamically -->
                            </div>
                            
                            <!-- VR Controls -->
                            <div class="vr-controls-overlay">
                                <div class="control-group">
                                    <button class="vr-control-btn" id="moveLeft">
                                        <i class="fas fa-arrow-left"></i>
                                    </button>
                                    <button class="vr-control-btn" id="moveForward">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="vr-control-btn" id="moveRight">
                                        <i class="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                                <div class="control-group">
                                    <button class="vr-control-btn" id="lookUp">
                                        <i class="fas fa-chevron-up"></i>
                                    </button>
                                    <button class="vr-control-btn" id="lookDown">
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-3">
                <!-- Destination Info -->
                <div class="card shadow mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-map-marker-alt me-2"></i>Current Location</h5>
                    </div>
                    <div class="card-body">
                        <div class="location-info">
                            <h6 id="currentLocation">Paris, France</h6>
                            <p class="text-muted" id="locationDescription">Experience the magic of the City of Light in stunning 360째 virtual reality.</p>
                            <div class="location-stats">
                                <div class="stat-item">
                                    <span class="stat-label">Hotspots</span>
                                    <span class="stat-value" id="hotspotCount">12</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Duration</span>
                                    <span class="stat-value" id="tourDuration">15 min</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hotspots List -->
                <div class="card shadow mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-crosshairs me-2"></i>Interactive Hotspots</h5>
                    </div>
                    <div class="card-body">
                        <div class="hotspots-list" id="hotspotsList">
                            <div class="hotspot-item active" data-hotspot="eiffel-tower">
                                <div class="hotspot-icon">
                                    <i class="fas fa-monument"></i>
                                </div>
                                <div class="hotspot-details">
                                    <div class="hotspot-name">Eiffel Tower</div>
                                    <div class="hotspot-description">Iconic iron lattice tower</div>
                                </div>
                            </div>
                            <div class="hotspot-item" data-hotspot="louvre">
                                <div class="hotspot-icon">
                                    <i class="fas fa-landmark"></i>
                                </div>
                                <div class="hotspot-details">
                                    <div class="hotspot-name">Louvre Museum</div>
                                    <div class="hotspot-description">World's largest art museum</div>
                                </div>
                            </div>
                            <div class="hotspot-item" data-hotspot="notre-dame">
                                <div class="hotspot-icon">
                                    <i class="fas fa-church"></i>
                                </div>
                                <div class="hotspot-details">
                                    <div class="hotspot-name">Notre-Dame</div>
                                    <div class="hotspot-description">Medieval Catholic cathedral</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VR Settings -->
                <div class="card shadow mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-cog me-2"></i>VR Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="setting-item">
                            <label class="form-label">Quality</label>
                            <select class="form-select" id="qualitySetting">
                                <option value="low">Low (Faster)</option>
                                <option value="medium" selected>Medium (Balanced)</option>
                                <option value="high">High (Best)</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label class="form-label">Movement Speed</label>
                            <input type="range" class="form-range" id="movementSpeed" min="1" max="10" value="5">
                        </div>
                        <div class="setting-item">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="autoRotate" checked>
                                <label class="form-check-label" for="autoRotate">
                                    Auto-rotate view
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="card shadow">
                    <div class="card-body">
                        <button class="btn btn-primary w-100 mb-2" id="bookExperienceBtn">
                            <i class="fas fa-calendar-check me-2"></i>Book This Experience
                        </button>
                        <button class="btn btn-outline-secondary w-100 mb-2" id="shareExperienceBtn">
                            <i class="fas fa-share me-2"></i>Share Experience
                        </button>
                        <button class="btn btn-outline-info w-100" id="downloadTourBtn">
                            <i class="fas fa-download me-2"></i>Download Tour
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Available VR Tours -->
    <div class="bg-light py-5">
        <div class="container">
            <h2 class="text-center mb-5">Available VR Tours</h2>
            <div class="row g-4">
                <div class="col-lg-4 col-md-6">
                    <div class="vr-tour-card">
                        <div class="tour-preview">
                            <img src="/static/images/paris-vr.jpg" alt="Paris VR Tour">
                            <div class="tour-overlay">
                                <button class="btn btn-light" onclick="loadVRTour('paris')">
                                    <i class="fas fa-play me-2"></i>Start Tour
                                </button>
                            </div>
                        </div>
                        <div class="tour-info">
                            <h5>Paris, France</h5>
                            <p>Experience the magic of the City of Light with 15 interactive hotspots.</p>
                            <div class="tour-meta">
                                <span><i class="fas fa-clock me-1"></i>15 min</span>
                                <span><i class="fas fa-crosshairs me-1"></i>15 hotspots</span>
                                <span><i class="fas fa-star me-1"></i>4.8</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="vr-tour-card">
                        <div class="tour-preview">
                            <img src="/static/images/tokyo-vr.jpg" alt="Tokyo VR Tour">
                            <div class="tour-overlay">
                                <button class="btn btn-light" onclick="loadVRTour('tokyo')">
                                    <i class="fas fa-play me-2"></i>Start Tour
                                </button>
                            </div>
                        </div>
                        <div class="tour-info">
                            <h5>Tokyo, Japan</h5>
                            <p>Explore the vibrant streets and modern architecture of Tokyo.</p>
                            <div class="tour-meta">
                                <span><i class="fas fa-clock me-1"></i>20 min</span>
                                <span><i class="fas fa-crosshairs me-1"></i>18 hotspots</span>
                                <span><i class="fas fa-star me-1"></i>4.9</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="vr-tour-card">
                        <div class="tour-preview">
                            <img src="/static/images/newyork-vr.jpg" alt="New York VR Tour">
                            <div class="tour-overlay">
                                <button class="btn btn-light" onclick="loadVRTour('newyork')">
                                    <i class="fas fa-play me-2"></i>Start Tour
                                </button>
                            </div>
                        </div>
                        <div class="tour-info">
                            <h5>New York, USA</h5>
                            <p>Discover the iconic landmarks and bustling streets of NYC.</p>
                            <div class="tour-meta">
                                <span><i class="fas fa-clock me-1"></i>18 min</span>
                                <span><i class="fas fa-crosshairs me-1"></i>16 hotspots</span>
                                <span><i class="fas fa-star me-1"></i>4.7</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- VR Help Modal -->
<div class="modal fade" id="vrHelpModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">How to Use VR Tours</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Desktop Controls</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-mouse me-2"></i>Click and drag to look around</li>
                            <li><i class="fas fa-arrows-alt me-2"></i>Use arrow keys to move</li>
                            <li><i class="fas fa-expand me-2"></i>Press F for fullscreen</li>
                            <li><i class="fas fa-crosshairs me-2"></i>Click hotspots to interact</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Mobile Controls</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-mobile-alt me-2"></i>Move device to look around</li>
                            <li><i class="fas fa-hand-pointer me-2"></i>Tap to interact</li>
                            <li><i class="fas fa-vr-cardboard me-2"></i>Use VR headset for immersion</li>
                            <li><i class="fas fa-volume-up me-2"></i>Enable sound for full experience</li>
                        </ul>
                    </div>
                </div>
                <div class="alert alert-info mt-3">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Pro tip:</strong> For the best experience, use a VR headset or view in fullscreen mode on a large screen.
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.vr-headset {
    position: relative;
    width: 200px;
    height: 120px;
    margin: 0 auto;
    background: linear-gradient(45deg, #333, #666);
    border-radius: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

.vr-lens {
    width: 60px;
    height: 60px;
    background: radial-gradient(circle, #000 30%, #333 70%);
    border-radius: 50%;
    position: absolute;
    top: 30px;
}

.vr-lens.left {
    left: 30px;
}

.vr-lens.right {
    right: 30px;
}

.vr-screen {
    width: 80px;
    height: 40px;
    background: linear-gradient(45deg, #667eea, #764ba2);
    border-radius: 8px;
    animation: screenGlow 2s infinite alternate;
}

@keyframes screenGlow {
    0% { box-shadow: 0 0 10px rgba(102, 126, 234, 0.5); }
    100% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.8); }
}

.vr-viewer {
    position: relative;
    width: 100%;
    height: 500px;
    background: #000;
    border-radius: 8px;
    overflow: hidden;
}

.vr-scene {
    width: 100%;
    height: 100%;
    position: relative;
    background: url('/static/images/paris-360.jpg') center center;
    background-size: cover;
    cursor: grab;
}

.vr-scene:active {
    cursor: grabbing;
}

.loading-spinner {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: white;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.vr-hotspots {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.vr-hotspot {
    position: absolute;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    pointer-events: all;
    animation: pulse 2s infinite;
    transition: all 0.3s ease;
}

.vr-hotspot:hover {
    transform: scale(1.2);
    background: rgba(102, 126, 234, 0.9);
    color: white;
}

.vr-controls-overlay {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
}

.control-group {
    display: flex;
    gap: 5px;
}

.vr-control-btn {
    width: 40px;
    height: 40px;
    background: rgba(0, 0, 0, 0.7);
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
}

.vr-control-btn:hover {
    background: rgba(102, 126, 234, 0.8);
    transform: scale(1.1);
}

.location-stats {
    display: flex;
    gap: 20px;
    margin-top: 15px;
}

.stat-item {
    text-align: center;
}

.stat-label {
    display: block;
    font-size: 0.8rem;
    color: #6c757d;
}

.stat-value {
    display: block;
    font-weight: bold;
    color: #495057;
}

.hotspots-list {
    max-height: 300px;
    overflow-y: auto;
}

.hotspot-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 8px;
}

.hotspot-item:hover {
    background: #f8f9fa;
}

.hotspot-item.active {
    background: #e3f2fd;
    border-left: 4px solid #2196f3;
}

.hotspot-icon {
    width: 40px;
    height: 40px;
    background: #667eea;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.hotspot-details {
    flex: 1;
}

.hotspot-name {
    font-weight: 600;
    color: #495057;
}

.hotspot-description {
    font-size: 0.8rem;
    color: #6c757d;
}

.setting-item {
    margin-bottom: 20px;
}

.setting-item:last-child {
    margin-bottom: 0;
}

.vr-tour-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.vr-tour-card:hover {
    transform: translateY(-5px);
}

.tour-preview {
    position: relative;
    height: 200px;
    overflow: hidden;
}

.tour-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.tour-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.vr-tour-card:hover .tour-overlay {
    opacity: 1;
}

.tour-info {
    padding: 20px;
}

.tour-info h5 {
    margin-bottom: 10px;
    color: #495057;
}

.tour-info p {
    color: #6c757d;
    font-size: 0.9rem;
    margin-bottom: 15px;
}

.tour-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: #6c757d;
}

@media (max-width: 768px) {
    .vr-viewer {
        height: 300px;
    }
    
    .vr-controls-overlay {
        bottom: 10px;
    }
    
    .vr-control-btn {
        width: 35px;
        height: 35px;
        font-size: 0.8rem;
    }
}
</style>

<script>
class VirtualRealityTour {
    constructor() {
        this.currentTour = 'paris';
        this.isVRMode = false;
        this.isFullscreen = false;
        this.autoRotate = true;
        this.movementSpeed = 5;
        this.quality = 'medium';
        this.hotspots = [];
        this.currentHotspot = null;
        this.init();
    }

    init() {
        this.bindEvents();
        this.loadTour(this.currentTour);
        this.setupHotspots();
    }

    bindEvents() {
        // VR controls
        document.getElementById('startVRTour').addEventListener('click', () => {
            this.startTour();
        });

        document.getElementById('fullscreenBtn').addEventListener('click', () => {
            this.toggleFullscreen();
        });

        document.getElementById('vrModeBtn').addEventListener('click', () => {
            this.toggleVRMode();
        });

        // Movement controls
        document.getElementById('moveLeft').addEventListener('click', () => {
            this.move('left');
        });

        document.getElementById('moveRight').addEventListener('click', () => {
            this.move('right');
        });

        document.getElementById('moveForward').addEventListener('click', () => {
            this.move('forward');
        });

        document.getElementById('lookUp').addEventListener('click', () => {
            this.look('up');
        });

        document.getElementById('lookDown').addEventListener('click', () => {
            this.look('down');
        });

        // Settings
        document.getElementById('qualitySetting').addEventListener('change', (e) => {
            this.setQuality(e.target.value);
        });

        document.getElementById('movementSpeed').addEventListener('input', (e) => {
            this.setMovementSpeed(e.target.value);
        });

        document.getElementById('autoRotate').addEventListener('change', (e) => {
            this.setAutoRotate(e.target.checked);
        });

        // Hotspot interactions
        document.querySelectorAll('.hotspot-item').forEach(item => {
            item.addEventListener('click', () => {
                const hotspotId = item.dataset.hotspot;
                this.activateHotspot(hotspotId);
            });
        });

        // Action buttons
        document.getElementById('bookExperienceBtn').addEventListener('click', () => {
            this.bookExperience();
        });

        document.getElementById('shareExperienceBtn').addEventListener('click', () => {
            this.shareExperience();
        });

        document.getElementById('downloadTourBtn').addEventListener('click', () => {
            this.downloadTour();
        });

        // Mouse/touch controls
        this.setupMouseControls();
    }

    loadTour(tourName) {
        const tours = {
            paris: {
                name: 'Paris, France',
                description: 'Experience the magic of the City of Light in stunning 360째 virtual reality.',
                hotspots: 12,
                duration: '15 min',
                background: '/static/images/paris-360.jpg',
                hotspots: [
                    { id: 'eiffel-tower', x: 50, y: 30, name: 'Eiffel Tower', description: 'Iconic iron lattice tower' },
                    { id: 'louvre', x: 70, y: 60, name: 'Louvre Museum', description: 'World\'s largest art museum' },
                    { id: 'notre-dame', x: 30, y: 70, name: 'Notre-Dame', description: 'Medieval Catholic cathedral' }
                ]
            },
            tokyo: {
                name: 'Tokyo, Japan',
                description: 'Explore the vibrant streets and modern architecture of Tokyo.',
                hotspots: 18,
                duration: '20 min',
                background: '/static/images/tokyo-360.jpg',
                hotspots: [
                    { id: 'shibuya', x: 40, y: 40, name: 'Shibuya Crossing', description: 'World\'s busiest pedestrian crossing' },
                    { id: 'tokyo-tower', x: 60, y: 30, name: 'Tokyo Tower', description: 'Iconic communications tower' }
                ]
            },
            newyork: {
                name: 'New York, USA',
                description: 'Discover the iconic landmarks and bustling streets of NYC.',
                hotspots: 16,
                duration: '18 min',
                background: '/static/images/newyork-360.jpg',
                hotspots: [
                    { id: 'times-square', x: 50, y: 50, name: 'Times Square', description: 'Famous commercial intersection' },
                    { id: 'statue-liberty', x: 20, y: 40, name: 'Statue of Liberty', description: 'Iconic American monument' }
                ]
            }
        };

        const tour = tours[tourName];
        if (!tour) return;

        this.currentTour = tourName;
        this.hotspots = tour.hotspots;

        // Update UI
        document.getElementById('currentLocation').textContent = tour.name;
        document.getElementById('locationDescription').textContent = tour.description;
        document.getElementById('hotspotCount').textContent = tour.hotspots.length;
        document.getElementById('tourDuration').textContent = tour.duration;

        // Load background
        const scene = document.getElementById('vrScene');
        scene.style.backgroundImage = `url('${tour.background}')`;

        // Setup hotspots
        this.setupHotspots();
    }

    setupHotspots() {
        const hotspotsContainer = document.getElementById('vrHotspots');
        hotspotsContainer.innerHTML = '';

        this.hotspots.forEach(hotspot => {
            const hotspotElement = document.createElement('div');
            hotspotElement.className = 'vr-hotspot';
            hotspotElement.style.left = `${hotspot.x}%`;
            hotspotElement.style.top = `${hotspot.y}%`;
            hotspotElement.innerHTML = '<i class="fas fa-crosshairs"></i>';
            hotspotElement.title = hotspot.name;
            
            hotspotElement.addEventListener('click', () => {
                this.activateHotspot(hotspot.id);
            });

            hotspotsContainer.appendChild(hotspotElement);
        });
    }

    activateHotspot(hotspotId) {
        const hotspot = this.hotspots.find(h => h.id === hotspotId);
        if (!hotspot) return;

        this.currentHotspot = hotspot;

        // Update active state in sidebar
        document.querySelectorAll('.hotspot-item').forEach(item => {
            item.classList.remove('active');
            if (item.dataset.hotspot === hotspotId) {
                item.classList.add('active');
            }
        });

        // Show hotspot info
        this.showHotspotInfo(hotspot);
    }

    showHotspotInfo(hotspot) {
        // Create modal or overlay with hotspot information
        const modal = document.createElement('div');
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">${hotspot.name}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>${hotspot.description}</p>
                        <div class="hotspot-actions">
                            <button class="btn btn-primary" onclick="vrTour.bookHotspot('${hotspot.id}')">
                                <i class="fas fa-calendar-check me-2"></i>Book Experience
                            </button>
                            <button class="btn btn-outline-secondary" onclick="vrTour.learnMore('${hotspot.id}')">
                                <i class="fas fa-info-circle me-2"></i>Learn More
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;

        document.body.appendChild(modal);
        new bootstrap.Modal(modal).show();
    }

    setupMouseControls() {
        const scene = document.getElementById('vrScene');
        let isDragging = false;
        let startX, startY;

        scene.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            scene.style.cursor = 'grabbing';
        });

        scene.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;

            // Simulate camera movement
            this.moveCamera(deltaX, deltaY);

            startX = e.clientX;
            startY = e.clientY;
        });

        scene.addEventListener('mouseup', () => {
            isDragging = false;
            scene.style.cursor = 'grab';
        });

        scene.addEventListener('mouseleave', () => {
            isDragging = false;
            scene.style.cursor = 'grab';
        });
    }

    moveCamera(deltaX, deltaY) {
        // Simulate camera movement by adjusting background position
        const scene = document.getElementById('vrScene');
        const currentTransform = scene.style.transform || 'translate(0px, 0px)';
        
        // Parse current transform
        const match = currentTransform.match(/translate\(([^,]+),\s*([^)]+)\)/);
        const currentX = match ? parseInt(match[1]) : 0;
        const currentY = match ? parseInt(match[2]) : 0;

        // Calculate new position
        const newX = currentX + deltaX * 0.1;
        const newY = currentY + deltaY * 0.1;

        // Apply new transform
        scene.style.transform = `translate(${newX}px, ${newY}px)`;
    }

    move(direction) {
        console.log(`Moving ${direction}`);
        // Implement movement logic
    }

    look(direction) {
        console.log(`Looking ${direction}`);
        // Implement look logic
    }

    toggleFullscreen() {
        const viewer = document.getElementById('vrViewer');
        
        if (!this.isFullscreen) {
            if (viewer.requestFullscreen) {
                viewer.requestFullscreen();
            } else if (viewer.webkitRequestFullscreen) {
                viewer.webkitRequestFullscreen();
            } else if (viewer.msRequestFullscreen) {
                viewer.msRequestFullscreen();
            }
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }

        this.isFullscreen = !this.isFullscreen;
    }

    toggleVRMode() {
        this.isVRMode = !this.isVRMode;
        const btn = document.getElementById('vrModeBtn');
        
        if (this.isVRMode) {
            btn.innerHTML = '<i class="fas fa-desktop"></i>';
            btn.title = 'Exit VR Mode';
            this.enableVRMode();
        } else {
            btn.innerHTML = '<i class="fas fa-vr-cardboard"></i>';
            btn.title = 'Enter VR Mode';
            this.disableVRMode();
        }
    }

    enableVRMode() {
        // Implement VR mode features
        console.log('VR mode enabled');
    }

    disableVRMode() {
        // Disable VR mode features
        console.log('VR mode disabled');
    }

    setQuality(quality) {
        this.quality = quality;
        console.log(`Quality set to: ${quality}`);
    }

    setMovementSpeed(speed) {
        this.movementSpeed = speed;
        console.log(`Movement speed set to: ${speed}`);
    }

    setAutoRotate(enabled) {
        this.autoRotate = enabled;
        console.log(`Auto-rotate ${enabled ? 'enabled' : 'disabled'}`);
    }

    startTour() {
        console.log('Starting VR tour...');
        // Implement tour start logic
    }

    bookExperience() {
        if (this.currentHotspot) {
            window.location.href = `/book/experience/${this.currentHotspot.id}`;
        } else {
            window.location.href = '/book/experience';
        }
    }

    shareExperience() {
        const url = window.location.href;
        const title = 'Check out this amazing VR tour!';
        
        if (navigator.share) {
            navigator.share({
                title: title,
                url: url
            });
        } else {
            // Fallback to copying to clipboard
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
            });
        }
    }

    downloadTour() {
        console.log('Downloading tour...');
        // Implement tour download logic
    }

    bookHotspot(hotspotId) {
        window.location.href = `/book/hotspot/${hotspotId}`;
    }

    learnMore(hotspotId) {
        window.location.href = `/hotspot/${hotspotId}`;
    }
}

// Global function for loading tours
function loadVRTour(tourName) {
    if (window.vrTour) {
        window.vrTour.loadTour(tourName);
    }
}

// Initialize VR tour when page loads
document.addEventListener('DOMContentLoaded', function() {
    window.vrTour = new VirtualRealityTour();
});
</script>
{% endblock %} 